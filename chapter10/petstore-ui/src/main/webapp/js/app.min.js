var Router=ReactRouter,RouteHandler=Router.RouteHandler,DefaultRoute=Router.DefaultRoute,Link=Router.Link,Route=Router.Route,clientApiGateway=customerGatewayUrl;function post(a,b,c){for(var f in c)c.hasOwnProperty(f)&&(a+="?"+f+"="+c[f]);var g=new Headers({Accept:"application/json","Content-Type":"application/json"});null!=keycloak.token&&g.set("Authorization","Bearer "+keycloak.token),fetch(clientApiGateway+"/"+a,{headers:g,method:"POST",body:JSON.stringify(b)}).catch(function(h){console.log(h.stack)})}function remove(a){remove(a,{})}function remove(a,b){for(var c in b)b.hasOwnProperty(c)&&(a+="?"+c+"="+b[c]);var f=new Headers({Accept:"application/json","Content-Type":"application/json"});null!=keycloak.token&&f.set("Authorization","Bearer "+keycloak.token),fetch(clientApiGateway+"/"+a,{headers:f,method:"DELETE"}).catch(function(g){console.log(g.stack)})}var Item=React.createClass({displayName:"Item",getInitialState:function(){return{quantity:1}},handleChange:function(a){this.setState({quantity:a.target.value})},onAddToCart:function(a){if(keycloak.authenticated){var b=this.props.item,c={itemId:b.itemId,quantity:this.state.quantity};post("cart/"+userInfo.sub,c,{additive:!0})}else alert("You must be logged in to add the item to the cart");a.preventDefault()},render:function(){var a=this.props.item;return React.createElement("div",{className:"col-md-3"},React.createElement("div",{className:"pet-grid"},React.createElement("div",{className:"row"},React.createElement("h3",null,a.name)),React.createElement("div",{className:"row"},React.createElement("p",{className:"description"},a.description)),React.createElement("div",{className:"row"},React.createElement("div",{className:"dock-right"},React.createElement("h4",null,a.price,"$"))),React.createElement("form",{className:"form-inline"},React.createElement("div",{className:"row"},React.createElement("div",{className:"dock-right"},React.createElement("input",{type:"number",className:"form-control",min:"1",max:"9",defaultValue:"1",onChange:this.handleChange}),React.createElement("input",{type:"button",className:"btn btn-default",value:"Add to cart",onClick:this.onAddToCart}))))))}}),Catalog=React.createClass({displayName:"Catalog",render:function(){return React.createElement("div",{className:"container"},this.state.items.map(function(a){return React.createElement(Item,{key:a.name,item:a})}))},getInitialState:function(){return{items:[]}},componentDidMount:function(){var a=new Headers({Accept:"application/json","Content-Type":"application/json"});null!=keycloak.token&&a.set("Authorization","Bearer "+keycloak.token),fetch(clientApiGateway+"/catalog/item",{headers:a,method:"GET"}).then(b=>{return console.log(b),b.json()}).then(b=>{this.setState({items:b})}).catch(function(b){console.log(b.stack)})}}),Cart=React.createClass({displayName:"Cart",getInitialState:function(){return{items:[]}},load:function(){console.log(clientApiGateway+"/cart/"+userInfo.sub);var a=new Headers({Accept:"application/json","Content-Type":"application/json"});null!=keycloak.token&&a.set("Authorization","Bearer "+keycloak.token),fetch(clientApiGateway+"/cart/"+userInfo.sub,{method:"GET",headers:a}).then(b=>{return b.json()}).then(b=>{for(var c=0,f=0;f<b.length;f++)c+=b[f].price*b[f].quantity;this.setState({items:b,total:c})}).catch(function(b){console.log(b.stack)})},componentDidMount:function(){this.load()},render:function(){return React.createElement("div",{className:"container"},React.createElement("div",{className:"col-md-3"}),React.createElement("div",{className:"col-md-6"},React.createElement("table",{id:"cart",className:"table table-hover table-condensed"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{width:"60%",className:"text-center"},"Product"),React.createElement("th",{width:"15%",className:"text-center"},"Price"),React.createElement("th",{width:"5%",className:"text-center"},"Quantity"),React.createElement("th",{width:"5%",className:"text-center"}),React.createElement("th",{width:"15%",className:"text-center"},"Subtotal"))),React.createElement("tbody",null,this.state.items.map(a=>{return React.createElement(CartItem,{key:a.itemId,item:a,reloadParent:this.load.bind(this)})})),React.createElement("tfoot",null,React.createElement("tr",{className:"visible-xs"},React.createElement("td",{className:"text-center"},React.createElement("strong",null,"Total 1.99"))),React.createElement("tr",null,React.createElement("td",null,React.createElement(Link,{to:"catalog",className:"btn btn-default"},"Continue shopping")),React.createElement("td",{colspan:"2",className:"hidden-xs"}),React.createElement("td",{className:"hidden-xs text-center"},React.createElement("strong",null,"Total ",this.state.total)))))),React.createElement("div",{className:"col-md-3"}))}}),CartItem=React.createClass({displayName:"CartItem",getInitialState:function(){return{item:this.props.item}},handleChange(a){var b=this.state.item;b.quantity=a.target.value,this.setState({item:b}),post("cart/"+userInfo.sub,{itemId:b.itemId,quantity:b.quantity},{additive:!1}),this.props.reloadParent()},removeItem(){var a=this.state.item;remove("cart/"+userInfo.sub+"/"+a.itemId),this.props.reloadParent()},render:function(){var a=this.state.item;return React.createElement("tr",null,React.createElement("td",{"data-th":"Product",className:"text-center"},React.createElement("h3",null,a.name)),React.createElement("td",{"data-th":"Price",className:"text-center"},a.price,"$"),React.createElement("td",{"data-th":"Quantity",className:"text-center"},React.createElement("input",{type:"number",className:"form-control",value:a.quantity,onChange:this.handleChange})),React.createElement("td",{className:"text-center"},React.createElement("span",{className:"glyphicon glyphicon-remove",onClick:this.removeItem})),React.createElement("td",{"data-th":"Subtotal",className:"text-center"},a.price*a.quantity,"$"))}}),GuestHeader=React.createClass({displayName:"GuestHeader",onClick:function(){return keycloak.login(),!1},render:function(){return React.createElement("ul",{className:"nav navbar-nav navbar-right"},React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClick},React.createElement("span",{className:"glyphicon glyphicon-log-in"})," Login")))}}),UserHeader=React.createClass({displayName:"UserHeader",getInitialState:function(){return{username:userInfo.preferred_username}},render:function(){return React.createElement("ul",{className:"nav navbar-nav navbar-right"},React.createElement("li",null,React.createElement("a",{href:" "},React.createElement("span",{className:"glyphicon glyphicon-user"}),this.state.username)),React.createElement("li",null,React.createElement(Link,{to:"cart"},React.createElement("span",{className:"glyphicon glyphicon-shopping-cart"}),"Cart")),React.createElement("li",null,React.createElement("a",{href:keycloak.createLogoutUrl({redirectUri:document.location.protocol+"//"+document.location.host})},React.createElement("span",{className:"glyphicon glyphicon-log-out"})," Logout")))}}),Header=React.createClass({displayName:"Header",render:function(){var a;return a=keycloak&&keycloak.authenticated?React.createElement(UserHeader,null):React.createElement(GuestHeader,null),React.createElement("nav",{className:"navbar navbar-default"},React.createElement("div",{className:"navbar-header"},React.createElement(Link,{to:"catalog"},React.createElement("h1",null,"Swarm Petstore"))),React.createElement("div",{className:"collapse navbar-collapse",id:"myNavbar"},a))}}),App=React.createClass({displayName:"App",render:function(){return React.createElement("div",null,React.createElement(Header,null),React.createElement(RouteHandler,null))}}),routes=React.createElement(Route,{handler:App,path:"/"},React.createElement(DefaultRoute,{name:"catalog",handler:Catalog}),React.createElement(Route,{name:"cart",handler:Cart})),userInfo;keycloak.init({onLoad:"check-sso"}).success(function(){keycloak.authenticated?(console.log("Keycloak authenticated"),keycloak.loadUserInfo().success(function(a){userInfo=a,Router.run(routes,Router.HistoryLocation,function(b){React.render(React.createElement(b,null),document.getElementById("container"))})})):Router.run(routes,Router.HistoryLocation,function(a){React.render(React.createElement(a,null),document.getElementById("container"))})});